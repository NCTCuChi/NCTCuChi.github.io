<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Nhân Sự</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.dataTables.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        h2 {
            color: #343a40;
            margin-bottom: 30px;
        }
        canvas {
            background-color: #ffffff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        table.dataTable {
            margin-top: 15px !important;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h2 class="text-center fw-bold">Dashboard Nhân Sự</h2>

        <div class="row g-4">
            <div class="col-md-6">
                <canvas id="salaryChart"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="genderChart"></canvas>
            </div>
        </div>

        <div class="row mt-4 g-4">
            <div class="col-md-6">
                <canvas id="joiningChart"></canvas>
            </div>
            <div class="col-md-6">
                <canvas id="ageChart"></canvas>
            </div>
        </div>

        <h3 class="mt-5">Danh sách Nhân viên</h3>
        <table id="employeeTable" class="table table-hover table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Tên</th>
                    <th>Tuổi</th>
                    <th>Giới tính</th>
                    <th>Lương</th>
                    <th>Ngày Gia Nhập</th>
                    <th>Phòng Ban</th>
                    <th>Thành Phố</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetch("https://script.googleusercontent.com/macros/echo?user_content_key=yM1XR63UFeoMaNJItYJ0Sk_aEKkUdhmTWGFUDPIGWJZQsnKZZP1Z4JZWDVzGjeEpYq5wd6pab2ijhA9l2Xjo59TWFiw7NeIZOJmA1Yb3SEsKFZqtv3DaNYcMrmhZHmUMWojr9NvTBuBLhyHCd5hHa8ER2BJ6BHIrvnA5XwukZ8ovolL8j1V9J25IxCktn80552Hlow2l337MSa1UhCkMo3k0Plm3nOKhhfi1U4G9DaMno0yshXGgVM3BI-dLAEELbuTgeJo7oVDQDDmPCF_Tzw&lib=MLAx3PPFhf3rlm25CDpMOL6VQSSnWPj7K")
                .then(response => response.json())
                .then(data => {
                    const employees = data.slice(1);

                    let tableBody = document.querySelector("#employeeTable tbody");
                    employees.forEach(emp => {
                        let row = `<tr>
                            <td>${emp[0]}</td>
                            <td>${emp[1]}</td>
                            <td>${emp[2]}</td>
                            <td>${emp[3]}</td>
                            <td>${new Date(emp[4]).toLocaleDateString()}</td>
                            <td>${emp[5]}</td>
                            <td>${emp[6]}</td>
                        </tr>`;
                        tableBody.innerHTML += row;
                    });

                    $("#employeeTable").DataTable({
                        dom: 'Bfrtip',
                        buttons: ['copy', 'csv', 'excel', 'pdf'],
                        pageLength: 5,
                        lengthMenu: [5, 10, 20]
                    });

                    const departments = {};
                    const genders = { "Male": 0, "Female": 0 };
                    const joinYears = {};
                    const ageGroups = { "20-29": 0, "30-39": 0, "40-49": 0 };

                    employees.forEach(emp => {
                        departments[emp[5]] = (departments[emp[5]] || 0) + emp[3];
                        genders[emp[2]]++;
                        let year = new Date(emp[4]).getFullYear();
                        joinYears[year] = (joinYears[year] || 0) + 1;
                        let age = emp[1];
                        if (age < 30) ageGroups["20-29"]++;
                        else if (age < 40) ageGroups["30-39"]++;
                        else ageGroups["40-49"]++;
                    });

                    new Chart(document.getElementById("salaryChart"), {
                        type: "bar",
                        data: {
                            labels: Object.keys(departments),
                            datasets: [{ label: "Lương Trung Bình", data: Object.values(departments), backgroundColor: "#007bff" }]
                        },
                        options: { responsive: true }
                    });

                    new Chart(document.getElementById("genderChart"), {
                        type: "bar",
                        data: {
                            labels: Object.keys(genders),
                            datasets: [{label: "Giới tính", data: Object.values(genders), backgroundColor: ["#ff6384", "#36a2eb"] }]
                        },
                        options: { responsive: true }
                    });

                    new Chart(document.getElementById("joiningChart"), {
                        type: "line",
                        data: {
                            labels: Object.keys(joinYears),
                            datasets: [{ label: "Số Nhân Viên", data: Object.values(joinYears), borderColor: "#28a745", fill: false }]
                        },
                        options: { responsive: true }
                    });

                    new Chart(document.getElementById("ageChart"), {
                        type: "line",
                        data: {
                            labels: Object.keys(ageGroups),
                            datasets: [{ label: "Độ tuổi", data: Object.values(ageGroups), backgroundColor: "#6f42c1" }]
                        },
                        options: { responsive: true }
                    });
                });
        });
    </script>
</body>
</html>
